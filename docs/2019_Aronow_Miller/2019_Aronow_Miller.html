<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Readings in Causal Inference, Fall 2023 - 5&nbsp; Foundations of Agnostic Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../2000_Dawid/2000_Dawid.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Foundations of Agnostic Statistics</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Readings in Causal Inference, Fall 2023</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Readings in Causal Inference, Fall 2023</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../1983_Rosenbaum_and_Rubin/1983_Rosenbaum_and_Rubin.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Central Role of Propensity Scores</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2000_Robins_Hernan_and_Brumback/2000_Robins_Hernan_and_Brumback.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Marginal Structural Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2000_Dawid/2000_Dawid.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Causal Inference Without Counterfactuals</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2019_Aronow_Miller/2019_Aronow_Miller.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Foundations of Agnostic Statistics</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#sharp-bounds-for-estimates" id="toc-sharp-bounds-for-estimates" class="nav-link" data-scroll-target="#sharp-bounds-for-estimates">Sharp Bounds for Estimates</a>
  <ul class="collapse">
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing Data</a></li>
  <li><a href="#causal-estimation" id="toc-causal-estimation" class="nav-link" data-scroll-target="#causal-estimation">Causal Estimation</a></li>
  </ul></li>
  <li><a href="#inverse-probability-weighting" id="toc-inverse-probability-weighting" class="nav-link" data-scroll-target="#inverse-probability-weighting">Inverse Probability Weighting</a>
  <ul class="collapse">
  <li><a href="#missing-data-1" id="toc-missing-data-1" class="nav-link" data-scroll-target="#missing-data-1">Missing Data</a></li>
  <li><a href="#causal-estimation-1" id="toc-causal-estimation-1" class="nav-link" data-scroll-target="#causal-estimation-1">Causal Estimation</a></li>
  </ul></li>
  <li><a href="#doubly-robust-estimation" id="toc-doubly-robust-estimation" class="nav-link" data-scroll-target="#doubly-robust-estimation">Doubly Robust Estimation</a>
  <ul class="collapse">
  <li><a href="#missing-data-2" id="toc-missing-data-2" class="nav-link" data-scroll-target="#missing-data-2">Missing Data</a></li>
  <li><a href="#causal-estimation-2" id="toc-causal-estimation-2" class="nav-link" data-scroll-target="#causal-estimation-2">Causal Estimation</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Foundations of Agnostic Statistics</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><a href="https://ctesta01.github.io/CausalFall2023/">‚Üê Home</a></p>
<p>Notes on <i>Foundations of Agnostic Statistics</i> by Peter M. Aronow and Benjamin T. Miller (2019), Cambridge University Press.</p>
<p><a href="https://doi.org/10.1017/9781316831762" class="uri">https://doi.org/10.1017/9781316831762</a></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>For this week‚Äôs reading, I jumped straight into the deep-end and read chapters 6 and 7 of Aronow and Miller‚Äôs (relatively) new book. I found their text extremely enjoyable and enlightening, and was especially excited to see their easy presentation of doubly-robust estimators, something I‚Äôve been looking around for for a while.</p>
<p>The other aspect that I particularly enjoyed was that they make the similarities between handling missing data and questions of causal inference as explicit as possible, going so far as to structure chapters 6 and 7 in parallel, 6 being about missing data and 7 being about causal inference.</p>
<p><strong>Definition.</strong> The stable outcomes model is for missing data is given <span class="math display">\[Y_i^* = \left\{ \begin{array}{ll} -99 &amp; R_i = 0 \\ Y_i &amp; R_i = 1 \end{array} \right.\]</span> where <span class="math inline">\(R_i\)</span> is the missingness indicator variable. This can also be written as <span class="math inline">\(Y_i^* = Y_i R_i + (-99)(1-R_i)\)</span>.</p>
<p>This is called the <em>stable outcomes model</em> because it presumes that <span class="math inline">\(Y_i\)</span> is itself a stable quantity.</p>
<p>As far as I can tell, they‚Äôre using <span class="math inline">\(-99\)</span> in the equations not because it makes the math go through, but because <span class="math inline">\(-99\)</span> is number commonly used to indicate missingness.</p>
</section>
<section id="sharp-bounds-for-estimates" class="level2">
<h2 class="anchored" data-anchor-id="sharp-bounds-for-estimates">Sharp Bounds for Estimates</h2>
<section id="missing-data" class="level3">
<h3 class="anchored" data-anchor-id="missing-data">Missing Data</h3>
<p><strong>Theorem 6.1.3.</strong> Sharp bounds for the expected value. Let <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(R_i\)</span> be random variables with support for <span class="math inline">\(Y_i\)</span> be restricted to <span class="math inline">\([a,b]\)</span>, <span class="math inline">\(\text{support}(R_i) \in \{0,1\}\)</span>, and <span class="math inline">\(Y_i*\)</span> is as in the stable outcomes model. Then</p>
<p><span class="math display">\[\begin{align}
\mathbb E[Y_i] \in \big[
\mathbb E[Y_i^* | &amp; R_i = 1]Pr(R_i=1) + aPr(R_i = 0), \\
&amp; \mathbb E[Y_i^* | R_i = 1]Pr(R_i=1) + bPr(R_i = 0)\big]. \\
\end{align}\]</span></p>
<p>I found this books‚Äô proofs quite clear and easy to follow, so I am not going to re-write them here and instead refer readers to the book.</p>
<p>Instead, I think some simulation exercise to build our intuition on this would be nice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># introduce the logistic function</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">exp</span>(x) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x)) }</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">logistic</span>(x), <span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2019_Aronow_Miller_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate our true outcome</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">2</span><span class="sc">*</span>A <span class="sc">+</span> A<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate our missingness mechanism</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">logistic</span>(A<span class="sc">+</span>Y))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># subset observed data</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>A_observed <span class="ot">&lt;-</span> A[<span class="fu">as.logical</span>(<span class="dv">1</span><span class="sc">-</span>R)]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Y_observed <span class="ot">&lt;-</span> Y[<span class="fu">as.logical</span>(<span class="dv">1</span><span class="sc">-</span>R)]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2019_Aronow_Miller_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A_observed, Y_observed)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate true regression equation</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">summ</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> A))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2019_Aronow_Miller_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Observations </td>
   <td style="text-align:right;"> 1000 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Dependent variable </td>
   <td style="text-align:right;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Type </td>
   <td style="text-align:right;"> OLS linear regression </td>
  </tr>
</tbody>
</table> <table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;"> F(1,998) </td>
   <td style="text-align:right;"> 1304.73 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> R¬≤ </td>
   <td style="text-align:right;"> 0.57 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Adj. R¬≤ </td>
   <td style="text-align:right;"> 0.57 </td>
  </tr>
</tbody>
</table> <table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Est. </th>
   <th style="text-align:right;"> S.E. </th>
   <th style="text-align:right;"> t val. </th>
   <th style="text-align:right;"> p </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;"> (Intercept) </td>
   <td style="text-align:right;"> 1.06 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 18.55 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> A </td>
   <td style="text-align:right;"> 2.02 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 36.12 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> Standard errors: OLS</td></tr></tfoot>
</table>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># missingness biased regression equation</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>jtools<span class="sc">::</span><span class="fu">summ</span>(<span class="fu">lm</span>(Y_observed <span class="sc">~</span> A_observed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Observations </td>
   <td style="text-align:right;"> 431 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Dependent variable </td>
   <td style="text-align:right;"> Y_observed </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Type </td>
   <td style="text-align:right;"> OLS linear regression </td>
  </tr>
</tbody>
</table> <table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;"> F(1,429) </td>
   <td style="text-align:right;"> 8.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> R¬≤ </td>
   <td style="text-align:right;"> 0.02 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> Adj. R¬≤ </td>
   <td style="text-align:right;"> 0.02 </td>
  </tr>
</tbody>
</table> <table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Est. </th>
   <th style="text-align:right;"> S.E. </th>
   <th style="text-align:right;"> t val. </th>
   <th style="text-align:right;"> p </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;"> (Intercept) </td>
   <td style="text-align:right;"> -0.46 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:right;"> -6.36 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;"> A_observed </td>
   <td style="text-align:right;"> 0.22 </td>
   <td style="text-align:right;"> 0.07 </td>
   <td style="text-align:right;"> 2.90 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> Standard errors: OLS</td></tr></tfoot>
</table>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create stable_outcomes_model</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Y_stable <span class="ot">&lt;-</span> Y<span class="sc">*</span>R <span class="sc">+</span> (<span class="sc">-</span><span class="dv">99</span>)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># lower bound on the A-Y effect</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Y_stable<span class="sc">*</span>R <span class="sc">+</span> <span class="fu">min</span>(Y_observed)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.4937127</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># upper bound on the A-Y effect</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Y_stable<span class="sc">*</span>R <span class="sc">+</span> <span class="fu">max</span>(Y_observed)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>R))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.803694</code></pre>
</div>
</div>
</section>
<section id="causal-estimation" class="level3">
<h3 class="anchored" data-anchor-id="causal-estimation">Causal Estimation</h3>
<p>In chapter 7, they provide a similar theorem that provides the means to bound a causal effect. There is one crucial difference, though, which is that because the average treatment effect is the difference between two potential outcomes (under treatment and under non-treatment), whereas the effect estimate in the missing data scenario is purely associational, the causal theorem has an additional subtracted term.</p>
<p><strong>Theorem 7.1.17.</strong> Sharp bounds for the average treatment effect.</p>
<p>Let <span class="math inline">\(Y_i(0)\)</span>, <span class="math inline">\(Y_i(1)\)</span>, and <span class="math inline">\(D_i\)</span> be random variables such that <span class="math inline">\(\forall d \in \{0, 1\},\)</span> <span class="math inline">\(\text{support}(Y_i(d)) \subset [a,b],\)</span> and <span class="math inline">\(\text{support}(D_i) = \{0,1\}\)</span>. Let <span class="math inline">\(Y_i = Y_i(1) \cdot D_i + Y_i(0) \cdot (1-D_i)\)</span> and <span class="math inline">\(\tau_i = Y_i(1) - Y_i(0)\)</span>. Then</p>
<p><span class="math display">\[\begin{aligned}\mathbb E[\tau_i] \in \big[ \mathbb E( &amp; Y_i | D_i = 1)Pr(D_i=1) + aPr(D_i = 0) \\
&amp;  -(\mathbb E(Y_i|D_i=0)Pr(D_i=0) + bPr(D_i=1)), \\
&amp; \mathbb E( Y_i | D_i = 1)Pr(D_i=1) + bPr(D_i = 0) \\
&amp; -(\mathbb E(Y_i|D_i=0)Pr(D_i=0) + aPr(D_i=1)) \big]. \end{aligned} \]</span></p>
<p>Let‚Äôs simulate some data and run an analysis to build some intuition around how this sharp bounding works. For example, we might imagine a scenario where the treatment assigment and the outcome are confounded, and hence the naive (unadjusted) estimate of the average treatment effect would be biased.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching core tidyverse packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 2.0.0 ‚îÄ‚îÄ
‚úî dplyr     1.1.2     ‚úî readr     2.1.4
‚úî forcats   1.0.0     ‚úî stringr   1.5.0
‚úî ggplot2   3.4.2     ‚úî tibble    3.2.1
‚úî lubridate 1.9.2     ‚úî tidyr     1.3.0
‚úî purrr     1.0.1     
‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
‚úñ dplyr::filter() masks stats::filter()
‚úñ dplyr::lag()    masks stats::lag()
‚Ñπ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">logistic</span>(L))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> L <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">2</span>) <span class="co"># outcome under treatment</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>Y0 <span class="ot">&lt;-</span> L <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">0</span>) <span class="co"># outcome under no treatment</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y1<span class="sc">*</span>D <span class="sc">+</span> Y0<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>D)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>unadjusted_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> D)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">D =</span> <span class="fu">as.factor</span>(D), <span class="at">Y =</span> Y),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> D, <span class="at">y =</span> Y, <span class="at">color =</span> D)) <span class="sc">+</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_sina</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">scale =</span> <span class="st">'width'</span>, <span class="at">maxwidth=</span>.<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> .<span class="dv">3</span>, <span class="at">outlier.color =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">'point'</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>) <span class="sc">+</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"D (treatment) and Y (outcome) are confounded by (unshown) L"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Averages are indicated by the open black circles"</span>) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"The biased estimate of average treatment effect is roughly "</span>, <span class="fu">round</span>(<span class="fu">coef</span>(unadjusted_model)[<span class="dv">2</span>], <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2019_Aronow_Miller_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:5in"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">L =</span> L, <span class="at">D =</span> <span class="fu">as.factor</span>(D), <span class="at">Y =</span> Y),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> L, <span class="at">y =</span> Y, <span class="at">color =</span> D)) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>, <span class="at">se=</span>F) <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>) <span class="sc">+</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">'D (treatment):'</span>) <span class="sc">+</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)) <span class="sc">+</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Conditioning on L allows us to see that the average treatment effect is actually 2"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2019_Aronow_Miller_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:6in"></p>
</figure>
</div>
</div>
</div>
<p>So now can we check if the sharp bounds contain 2, which they should as long as the theorem holds? (check the book for the proof!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y<span class="sc">*</span>D <span class="sc">+</span> <span class="fu">min</span>(Y)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>D) <span class="sc">-</span> Y<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>D) <span class="sc">-</span> <span class="fu">max</span>(Y)<span class="sc">*</span>D)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y<span class="sc">*</span>D <span class="sc">+</span> <span class="fu">max</span>(Y)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>D) <span class="sc">-</span> Y<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>D) <span class="sc">-</span> <span class="fu">min</span>(Y)<span class="sc">*</span>D)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"the true average treatment effect should be guaranteed to lie within:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "the true average treatment effect should be guaranteed to lie within:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"["</span>, <span class="fu">round</span>(lower_bound, <span class="dv">1</span>), <span class="st">', '</span>, <span class="fu">round</span>(upper_bound, <span class="dv">1</span>), <span class="st">"]"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[-4.1, 6.9]"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"is the actual average treatment effect within these bounds?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "is the actual average treatment effect within these bounds?"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">2</span> <span class="sc">&gt;=</span> lower_bound <span class="sc">&amp;</span> <span class="dv">2</span> <span class="sc">&lt;=</span> upper_bound) <span class="fu">print</span>(<span class="st">"yup! üôÇ"</span>) <span class="cf">else</span> <span class="fu">print</span>(<span class="st">"nope üòï"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "yup! üôÇ"</code></pre>
</div>
</div>
</section>
</section>
<section id="inverse-probability-weighting" class="level2">
<h2 class="anchored" data-anchor-id="inverse-probability-weighting">Inverse Probability Weighting</h2>
<section id="missing-data-1" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-1">Missing Data</h3>
<p>The inverse probability weighting for missing data described in theorem 6.2.6 for missing at random data is exactly the same as the propensity score weighting described in <a href="https://ctesta01.github.io/CausalFall2023/1983_Rosenbaum_and_Rubin/1983_Rosenbaum_and_Rubin.html">Rosenbaum and Rubin‚Äôs paper</a>.</p>
<p>What‚Äôs more interesting to me is to see that they provide a stabilized inverse probability weighting approach for missing data.</p>
<p><strong>Definition 6.2.8</strong> Stabilized IPW Estimator for Missing Data</p>
<p>Let <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(R_i\)</span> be random variables with <span class="math inline">\(\text{support}(R_i) = \{ 0, 1 \}\)</span>. Let <span class="math inline">\(Y_i^*\)</span> be as in the stable outcomes model and let <span class="math inline">\(X_i\)</span> be a random vector. Then given <span class="math inline">\(n\)</span> independently and identically distributed observations of <span class="math inline">\((Y_i^*, R_i, X_i)\)</span>, the stabilized IPW estimator for <span class="math inline">\(\mathbb E[Y_i]\)</span> is</p>
<p><span class="math display">\[ \hat{\mathbb E}_{SIPW} (Y_i) = \frac{\frac{1}{n} \sum_{i=1}^n \frac{Y_i R^i}{\hat p_R(X_i)}}{\frac{1}{n} \sum_{i=1}^n \frac{R^i}{\hat p_R(X_i)}}. \]</span></p>
</section>
<section id="causal-estimation-1" class="level3">
<h3 class="anchored" data-anchor-id="causal-estimation-1">Causal Estimation</h3>
<p>A similar stabilization approach is given for causal average treatment effects:</p>
<p><strong>Definition 7.2.7.</strong> Stabilized IPW Estimator for Causal Inference. Let <span class="math inline">\(Y_i(0)\)</span>, <span class="math inline">\(Y_i(1)\)</span>, and <span class="math inline">\(D_i\)</span> be random variables with <span class="math inline">\(\text{support}(D_i) = \{0,1\}\)</span>. Let <span class="math inline">\(Y_i = Y_i(1) \cdot D_i + Y_i(0) \cdot (1-D_i)\)</span> and <span class="math inline">\(\tau_i = Y_i(1) - Y_i(0)\)</span>, and let <span class="math inline">\(X_i\)</span> be a random vector. Then given <span class="math inline">\(n\)</span> i.i.d. observations of <span class="math inline">\((Y_i, D_i, X_i)\)</span>, the stabilized IPW estimator for <span class="math inline">\(\mathbb E[\tau_i]\)</span> is</p>
<p><span class="math display">\[\hat{\mathbb E}_{SIPW}[\tau_i] = \frac{
\frac{1}{n} \sum_{i=1}^n \frac{Y_iD_i}{\hat p_{D}(X_i)
}}{
\frac{1}{n} \sum_{i=1}^n \frac{D_i}{\hat p_{D}(X_i)
}} -
\frac{
\frac{1}{n} \sum_{i=1}^n \frac{Y_i(1-D_i)}{1 -\hat p_{D}(X_i)
}}{
\frac{1}{n} \sum_{i=1}^n \frac{1-D_i}{1-\hat p_{D}(X_i)
}}.
\]</span></p>
</section>
</section>
<section id="doubly-robust-estimation" class="level2">
<h2 class="anchored" data-anchor-id="doubly-robust-estimation">Doubly Robust Estimation</h2>
<section id="missing-data-2" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-2">Missing Data</h3>
<p><strong>Theorem 6.2.9</strong> Double Robustness Theorem for Missing Data. Let <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(Y_i^*\)</span>, <span class="math inline">\(R_i\)</span>, <span class="math inline">\(X_i\)</span> be as in definition 6.2.8 above. If missing at randomness holds and if either</p>
<ol type="1">
<li><p><span class="math inline">\(\hat{\mathbb E}[Y_i^*|R_i=1,X_i=x] = \mathbb E[Y_i^*|R_i=1,X_i=x]\)</span> for all <span class="math inline">\(x \in \text{support}(X_i)\)</span> and <span class="math inline">\(\exists \epsilon &gt; 0\)</span> such that <span class="math inline">\(\epsilon &lt; \hat p_R(x) &lt; 1-\epsilon\)</span>, or</p></li>
<li><p><span class="math inline">\(\hat p_R(x) = p_R(x)\)</span> for all <span class="math inline">\(x \in \text{support}(X_i)\)</span>,</p></li>
</ol>
<p>then:</p>
<p><span class="math display">\[\mathbb E[Y_i] = \mathbb E\left[ \hat{\mathbb E}[Y_i^*|R_i=1,X_i] + \frac{R_i\left(Y_i^* - \hat{\mathbb E}[Y_i^* | R_i=1,X_i] \right)}{\hat p_R(x)} \right].\]</span></p>
<p>What‚Äôs interesting about the proof is that it essentially follows in a straightforward fashion by assuming (case-by-case) that either 1 or 2 hold and seeing that the other terms cancel away leaving us with the term assumed to equal <span class="math inline">\(\mathbb E[Y_i]\)</span> in both cases.</p>
<p><strong>Definition 6.2.10</strong> Doubly Robust Estimator for Missing Data Let <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(Y_i^*\)</span>, <span class="math inline">\(R_i\)</span> and <span class="math inline">\(X_i\)</span> be as in definition 6.2.8. Then the <span class="vocab">doubly robust estimator</span> is given as</p>
<p><span class="math display">\[ \hat{\mathbb E}_{DR}[Y_i] = \frac{1}{n} \sum_{i=1}^n \hat{\mathbb E}[Y_i^* | R_i = 1, X_i] +
\frac{1}{n} \sum_{i=1}^n \frac{R_i \left(Y_i^* - \hat{\mathbb E}[Y_i^* | R_i = 1, X_i]\right)}{\hat p_R(X_i) }.\]</span></p>
</section>
<section id="causal-estimation-2" class="level3">
<h3 class="anchored" data-anchor-id="causal-estimation-2">Causal Estimation</h3>
<p>Turning our attention to causal inference, we have a similar double robustness theorem.</p>
<p><strong>Theorem 7.2.8.</strong> Double Robustness Theorem for Causal Inference. Let <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span> <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(X_i\)</span> be as in definition 7.2.7. If strong ignorability holds and if either</p>
<ol type="1">
<li><span class="math inline">\(\hat{\mathbb E}[Y_i|D_i=d,X_i=x] = \mathbb E[Y_i|D_i=d,X_i=x]\)</span> for all <span class="math inline">\(d \in \{0,1\}\)</span>, <span class="math inline">\(x \in \text{support}(X_i)\)</span> and <span class="math inline">\(\exists \epsilon &gt; 0\)</span> such that <span class="math inline">\(\epsilon &lt; \hat{p}_D(x) &lt; 1-\epsilon\)</span>, or</li>
<li><span class="math inline">\(\hat{p}_D(x) = p_D(x)\)</span>, for all <span class="math inline">\(x \in \text{support}(X_i)\)</span>,</li>
</ol>
<p>then:</p>
<p><span class="math display">\[ \begin{aligned}\mathbb E[\tau_i] = \mathbb E\Big[
\hat{\mathbb E}[Y_i|&amp; D_i=1,X_i] + \frac{D_i(Y_i - \hat{\mathbb E}[D_i=1,X_i])}{
\hat p_D(X_i)} \\
&amp; -\hat{\mathbb E}[Y_i|D_i=0,X_i] - \frac{(1-D_i)(Y_i - \hat{\mathbb E}[Y_i|D_i=0,X_i])}{1-\hat{p}_D(X_i)}\Big]. \end{aligned} \]</span></p>
<p><strong>Definition 7.2.9</strong> Doubly Robust Estimator for Causal Inference. Again, let <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span> <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(X_i\)</span> be as in definition 7.2.7. The <span class="vocab">doubly robust estimator</span> is</p>
<p><span class="math display">\[\begin{aligned}\hat{\mathbb E}_{DR}[\tau_i] = &amp; \frac{1}{n} \sum_{i=1}^n \hat{\mathbb E}[Y_i|D_i=1,X_i] +
\frac{1}{n}\sum_{i=1}^n \frac{D_i(Y_i - \hat{\mathbb E}[Y_i |D_i=1,X_i])}{\hat p_D(X_i)} \\
&amp; - \frac{1}{n}\sum_{i=1}^n [Y_i|D_i=0,X_i] -
\frac{1}{n}\sum_{i=1}^n \frac{(1-D_i)(Y_i - \hat{\mathbb E}[Y_i |D_i=0,X_i])}{1-\hat p_D(X_i)}.
\end{aligned}
\]</span></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="ctesta01/CausalFall2023" data-repo-id="R_kgDOKJFkiQ" data-category="General" data-category-id="DIC_kwDOKJFkic4CY4aM" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../2000_Dawid/2000_Dawid.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Causal Inference Without Counterfactuals</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>